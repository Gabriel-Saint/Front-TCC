<div class="cart-container">
  <!-- Cabeçalho com etapas -->
  <header class="cart-header">
    <button mat-icon-button class="back-button" *ngIf="checkoutStep !== 'items'" (click)="goToStep(checkoutStep === 'payment' ? 'checkout' : 'items')">
      <mat-icon>arrow_back_ios</mat-icon>
    </button>
    <div class="steps">
      <span [class.active]="checkoutStep === 'items'">Itens</span>
      <span [class.active]="checkoutStep === 'checkout'">Checkout</span>
      <span [class.active]="checkoutStep === 'payment'">Pagamento</span>
    </div>
    <button mat-icon-button (click)="closeCart.emit()">
      <mat-icon>close</mat-icon>
    </button>
  </header>

  <!-- Conteúdo da Sacola -->
  <div class="cart-content">
    <!-- Etapa 1: Itens -->
    <div *ngIf="checkoutStep === 'items'" class="items-view">
      <div *ngFor="let item of (cartItems$ | async)" class="cart-item">
        <img [src]="item.product.image" alt="">
        <div class="item-details">
          <p>{{ item.quantity }}x {{ item.product.name }}</p>
          <span>{{ item.product.price| currency:'BRL' }}</span>
        </div>
        <button mat-icon-button (click)="removeItem(item.product.id)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>

    <!-- Etapa 2: Checkout -->
    <div *ngIf="checkoutStep === 'checkout'" class="checkout-view">
      <form [formGroup]="checkoutForm">
        <h3>Dados do cliente</h3>
        <mat-form-field appearance="outline">
          <mat-label>Nome</mat-label>
          <input matInput formControlName="name">
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Telefone</mat-label>
          <input matInput formControlName="phone">
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>CPF (opcional)</mat-label>
          <input matInput formControlName="cpf">
        </mat-form-field>
      </form>
    </div>

    <!-- Etapa 3: Pagamento -->
    <div *ngIf="checkoutStep === 'payment'" class="payment-view">
      <div class="summary">
        <div><span>Subtotal</span> <span>{{ cartTotal$ | async | currency:'BRL' }}</span></div>
        <div><span>Taxa de entrega</span> <span>R$ 0,00</span></div>
        <div class="total"><span>Total</span> <span>{{ cartTotal$ | async | currency:'BRL' }}</span></div>
      </div>
      <h3>Pagamento</h3>
      <mat-accordion>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Dinheiro</mat-panel-title>
          </mat-expansion-panel-header>
          <p>Precisa de troco?</p>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header><mat-panel-title>Cartão de Crédito</mat-panel-title></mat-expansion-panel-header>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header><mat-panel-title>Pix</mat-panel-title></mat-expansion-panel-header>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>

  <!-- Rodapé com botão de ação -->
  <footer class="cart-actions">
    <button mat-raised-button color="primary" (click)="goToStep('checkout')" *ngIf="checkoutStep === 'items'">Próximo</button>
    <button mat-raised-button color="primary" (click)="goToStep('payment')" *ngIf="checkoutStep === 'checkout'">Ir para Pagamento</button>
    <button mat-raised-button color="primary" (click)="placeOrder()" *ngIf="checkoutStep === 'payment'">Finalizar Pedido</button>
  </footer>
</div>
